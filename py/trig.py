#! /usr/bin/python3
import numpy as np
import matplotlib.pyplot as plt

# x = np.linspace(0., 2.*np.pi, 400)
# y = 0.5 * np.pi - 23./180. * np.pi - x

# plt.plot(x / np.pi * 180., y / np.pi * 180., 'b-')
# plt.grid()
# plt.show()

bin_scan = {
    0 : {
        1 : [[28.271, 0.0520457], [61.7559, 0.0522573]],
        2 : [[27.6959, 0.0965399], [27.7294, 0.096255]],
        3 : [[21.0872, 0.0499035], [69.2717, 0.0498368]],
        4 : [[41.3524, 0.0716175], [41.4155, 0.0716051]],
        5 : [[20.0053, 0.0352787], [19.9315, 0.0352501]],
        6 : [[15.9238, 0.109294], [15.9231, 0.109956]],
        7 : [[62.25, 0.0596816], [62.3684, 0.0597857]],
        8 : [[28.3949, 0.0548593], [28.3948, 0.0548884]]
    },
    15 : {
        1 : [[61.9354, 0.0519188]],
        2 : [[27.4771, 0.0955709]],
        3 : [[69.7613, 0.0505411]],
        4 : [[19.3721, 0.0640438]],
        5 : [[20.0656, 0.0353103]],
        6 : [[16.2434, 0.115787]],
        7 : [[61.6928, 0.0590464]],
        8 : [[4.06606, 0.0834028]]
    },
    30 : {
        1 : [[27.625, 0.0507515]],
        2 : [[26.9467, 0.0957236]],
        3 : [[20.1867, 0.0512045]],
        4 : [[19.5265, 0.0639126]],
        5 : [[20.3285, 0.0354225]],
        6 : [[17.253, 0.129267]],
        7 : [[27.8192, 0.0584228]],
        8 : [[4.32867, 0.0825564]]
    },
    45 : {
        1 : [[63.412, 0.0488836]],
        2 : [[26.1667, 0.0968986]],
        3 : [[-19.516, 0.0516263]],
        4 : [[19.9227, 0.0638675]],
        5 : [[20.8771, 0.035729]],
        6 : [[18.3505, 0.145098]],
        7 : [[61.2509, 0.0584672]],
        8 : [[5.47925, 0.0808668]]
    },
    60 : {
        1 : [[25.6311, 0.0469772]],
        2 : [[25.0505, 0.0987695]],
        3 : [[70.4486, 0.0516238]],
        4 : [[20.4547, 0.0636232]],
        5 : [[21.521, 0.0360614]],
        6 : [[0,0]],
        7 : [[61.4777, 0.0586038]],
        8 : [[7.73507, 0.0785575]]
    },
    75 : {
        1 : [[65.6953, 0.045091]],
        2 : [[24.1964, 0.100252]],
        3 : [[20.1267, 0.0514385]],
        4 : [[39.8797, 0.0727698]],
        5 : [[67.402, 0.0364728]],
        6 : [[23.835, 0.165223]],
        7 : [[62.0727, 0.059071]],
        8 : [[26.1201, 0.0554033]]
    },
    90 : {
        1 : [[23.0772, 0.0432786]],
        2 : [[22.5277, 0.099397]],
        3 : [[69.8119, 0.0507353]],
        4 : [[21.9804, 0.0633212]],
        5 : [[23.121, 0.0370772]],
        6 : [[24.9344, 0.13573]],
        7 : [[62.7442, 0.0597409]],
        8 : [[24.8493, 0.0555534]]
    },
    105 : {
        1 : [[68.3068, 0.0417819]],
        2 : [[21.1908, 0.0974338]],
        3 : [[21.1243, 0.0500416]],
        4 : [[22.8177, 0.0631272]],
        5 : [[65.7027, 0.0376556]],
        6 : [[25.5196, 0.118124]],
        7 : [[63.852, 0.0609536]],
        8 : [[15.8823, 0.0781791]]
    },
    120 : {
        1 : [[69.3099, 0.0407013]],
        2 : [[19.6456, 0.0940584]],
        3 : [[68.4651, 0.0489216]],
        4 : [[23.7458, 0.0629152]],
        5 : [[64.8063, 0.0383987]],
        6 : [[25.9799, 0.108089]],
        7 : [[24.1532, 0.0622843]],
        8 : [[18.8756, 0.0793263]]
    },
    135 : {
        1 : [[70.1927, 0.0398277]],
        2 : [[18.4846, 0.0911612]],
        3 : [[22.7112, 0.0481645]],
        4 : [[34.4297, 0.0904058]],
        5 : [[25.4567, 0.0389288]],
        6 : [[25.9685, 0.100409]],
        7 : [[22.7921, 0.0642844]],
        8 : [[21.7372, 0.0804392]]
    },
    150 : {
        1 : [[19.2004, 0.0391618]],
        2 : [[17.3289, 0.0881844]],
        3 : [[23.5482, 0.0472486]],
        4 : [[25.36, 0.0626599]],
        5 : [[26.0513, 0.0394956]],
        6 : [[25.9767, 0.0957411]],
        7 : [[21.4183, 0.066631]],
        8 : [[24.4634, 0.0813463]]
    },
    165 : {
        1 : [[71.4302, 0.0387074]],
        2 : [[16.6655, 0.0864769]],
        3 : [[66.1926, 0.04648]],
        4 : [[3.85467, 0.0745263]],
        5 : [[26.3513, 0.0397879]],
        6 : [[25.6991, 0.0921568]],
        7 : [[68.8151, 0.0688872]],
        8 : [[26.6118, 0.0817136]]
    },
    180 : {
        1 : [[71.5562, 0.0385375]],
        2 : [[16.4944, 0.0870533]],
        3 : [[65.6398, 0.0459872]],
        4 : [[26.3116, 0.062544]],
        5 : [[26.4021, 0.0398825]],
        6 : [[25.559, 0.091155]],
        7 : [[-20.1524, 0.0711806]],
        8 : [[28.234, 0.0823362]]
    },
    195 : {
        1 : [[71.4328, 0.0385394]],
        2 : [[16.5432, 0.087708]],
        3 : [[65.1033, 0.0455093]],
        4 : [[26.4297, 0.0625133]],
        5 : [[63.3931, 0.0397168]],
        6 : [[25.1273, 0.09021]],
        7 : [[70.6817, 0.07334]],
        8 : [[28.8722, 0.0827302]]
    },
    210 : {
        1 : [[19.112, 0.0389352]],
        2 : [[17.0836, 0.0822178]],
        3 : [[25.5441, 0.0453573]],
        4 : [[3.53742, 0.0740901]],
        5 : [[63.7044, 0.0393928]],
        6 : [[24.7695, 0.0902109]],
        7 : [[17.5294, 0.0761121]],
        8 : [[17.2519, 0.0555462]]
    },
    225 : {
        1 : [[19.8025, 0.0393913]],
        2 : [[18.3205, 0.0964406]],
        3 : [[64.674, 0.0451395]],
        4 : [[4.26524, 0.0746296]],
        5 : [[64.3036, 0.0388108]],
        6 : [[23.9835, 0.092673]],
        7 : [[17.4885, 0.0762554]],
        8 : [[27.933, 0.0843764]]
    },
    240 : {
        1 : [[20.7297, 0.0402233]],
        2 : [[19.5617, 0.102526]],
        3 : [[64.7205, 0.0451664]],
        4 : [[32.631, 0.107539]],
        5 : [[24.5978, 0.0381506]],
        6 : [[23.6106, 0.0962984]],
        7 : [[71.3124, 0.075571]],
        8 : [[26.303, 0.0854698]]
    },
    255 : {
        1 : [[68.3878, 0.0412399]],
        2 : [[21.3263, 0.111384]],
        3 : [[64.9297, 0.0452875]],
        4 : [[24.8103, 0.0635636]],
        5 : [[23.838, 0.0375689]],
        6 : [[22.58, 0.100443]],
        7 : [[70.884, 0.074525]],
        8 : [[19.7313, 0.0549047]]
    },
    270 : {
        1 : [[23.0435, 0.0427432]],
        2 : [[23.6503, 0.120106]],
        3 : [[25.0234, 0.0456937]],
        4 : [[23.8957, 0.0637636]],
        5 : [[66.7038, 0.0369721]],
        6 : [[21.7857, 0.105378]],
        7 : [[69.8795, 0.0720456]],
        8 : [[21.2331, 0.0546134]]
    },
    285 : {
        1 : [[65.9223, 0.044273]],
        2 : [[25.3622, 0.11989]],
        3 : [[24.5197, 0.0461659]],
        4 : [[22.957, 0.0640615]],
        5 : [[67.4448, 0.0364923]],
        6 : [[20.5453, 0.110518]],
        7 : [[20.4276, 0.0691837]],
        8 : [[16.3727, 0.0828553]]
    },
    300 : {
        1 : [[64.5761, 0.0463342]],
        2 : [[26.5782, 0.113885]],
        3 : [[24.0261, 0.0465445]],
        4 : [[22.1142, 0.0642175]],
        5 : [[68.1953, 0.0360217]],
        6 : [[19.4865, 0.113499]],
        7 : [[21.9171, 0.066381]],
        8 : [[24.1697, 0.0544324]]
    },
    315 : {
        1 : [[26.5993, 0.0482109]],
        2 : [[27.305, 0.107575]],
        3 : [[23.2104, 0.0473972]],
        4 : [[21.4213, 0.0643729]],
        5 : [[68.776, 0.0357278]],
        6 : [[18.0316, 0.111755]],
        7 : [[23.2111, 0.06425]],
        8 : [[9.87592, 0.0802774]]
    },
    330 : {
        1 : [[62.5524, 0.0502301]],
        2 : [[27.6957, 0.102185]],
        3 : [[22.5133, 0.0481515]],
        4 : [[20.7502, 0.0642539]],
        5 : [[69.267, 0.0354549]],
        6 : [[16.989, 0.109895]],
        7 : [[64.3972, 0.0623058]],
        8 : [[26.8016, 0.0546189]]
    },
    345 : {
        1 : [[28.1095, 0.0476558]],
        2 : [[27.8167, 0.0979914]],
        3 : [[68.7388, 0.0491638]],
        4 : [[40.8805, 0.0717794]],
        5 : [[20.1012, 0.0353448]],
        6 : [[16.4085, 0.110465]],
        7 : [[63.3705, 0.0610019]],
        8 : [[4.99041, 0.0829256]]
    }
}

full_simple = {
    0   : [[23.6128, 0.0191962], [23.614, 0.0191973]],
    15  : [[23.622, 0.0192232]],
    30  : [[23.5905, 0.0192381]],
    45  : [[23.5194, 0.0192769]],
    60  : [[23.4103, 0.019318]],
    75  : [[23.2596, 0.0193288]],
    90  : [[23.1426, 0.0187767]],
    105 : [[22.9263, 0.0193846]],
    120 : [[22.8622, 0.0194282]],
    135 : [[22.716, 0.0194328]],
    150 : [[22.5945, 0.0194447]],
    165 : [[22.4602, 0.0194313]],
    180 : [[22.4056, 0.0194249]],
    195 : [[22.3968, 0.0193891]],
    210 : [[22.4082, 0.0193437]],
    225 : [[22.4723, 0.019313]],
    240 : [[22.5709, 0.0192856]],
    255 : [[22.6921, 0.0192472]],
    270 : [[22.8552, 0.0191982]],
    285 : [[23.0057, 0.0191854]],
    300 : [[23.2267, 0.0191594]],
    315 : [[23.3584, 0.019159]],
    330 : [[23.5093, 0.0191578]],
    345 : [[23.5761, 0.019176]]
}

approx_scan = {
    0 : {
        "beta" : [23.0364, 0.0194978],
          "rb" : [0.0500824, 0.000210892],
        "delb" : [0.58922, 0.317838]
    },

    # 15 : {
    #     "beta" : [23.6253, 0.0192065],
    #       "rb" : [4.52693e-14, 1.09076e-06],
    #     "delb" : [265.338, 0.589483]
    # },

    30 : {
        "beta" : [23.0153, 0.0194194],
          "rb" : [0.0505039, 0.000192478],
        "delb" : [30.3516, 0.309185]
    },

    45 : {
        "beta" : [22.9881, 0.0193755],
          "rb" : [0.0500913, 0.000220383],
        "delb" : [45.2681, 0.306078]
    },

    60 : {
        "beta" : [22.9977, 0.01941],
          "rb" : [0.05039, 0.00024],
        "delb" : [60.270, 0.284]
    },

    75 : {
        "beta" : [23.0556, 0.019284],
          "rb" : [0.0499445, 0.000259635],
        "delb" : [75.089, 0.261994]
    },

    # 90 : {
    #     "beta" : [],
    #       "rb" : [],
    #     "delb" : []
    # },

    105 : {
        "beta" : [22.9462, 0.0191618],
          "rb" : [0.0498629, 0.000279155],
        "delb" : [105.221, 0.23668]
    },

    120 : {
        "beta" : [23.0071, 0.0193531],
          "rb" : [0.0495705, 0.000287296],
        "delb" : [119.965, 0.241409]
    },

    135 : {
        "beta" : [23.0067, 0.0191459],
          "rb" : [0.0500149, 0.00022851],
        "delb" : [135.331, 0.274687]
    },

    150 : {
        "beta" : [22.9874, 0.0190973],
          "rb" : [0.0493291, 0.000250657],
        "delb" : [150.817, 0.283783]
    },

    165 : {
        "beta" : [22.9761, 0.0191115],
          "rb" : [0.0498439, 0.000230196],
        "delb" : [165.644, 0.301664]
    },

    180 : {
        "beta" : [22.953, 0.019],
          "rb" : [0.0499327, 0.000211883],
        "delb" : [180.624, 0.3166]
    },

    195 : {
        "beta" : [22.9461, 0.0191973],
          "rb" : [0.05013, 0.000186497],
        "delb" : [195.172, 0.321863]
    },

    210 : {
        "beta" : [22.9844, 0.0192333],
          "rb" : [0.05005, 0.0002043],
        "delb" : [210.865, 0.320168]
    },

    # 225 : {
    #     "beta" : [],
    #       "rb" : [],
    #     "delb" : []
    # },

    240 : {
        "beta" : [23.000187, 0.01940],
          "rb" : [0.0505671, 0.00023664],
        "delb" : [240.3555, 0.2907]
    },

    255 : {
        "beta" : [23.0131, 0.01947],
          "rb" : [0.0501291, 0.000259542],
        "delb" : [255.097, 0.2679]
    },

    270 : {
        "beta" : [23.0075, 0.0194553],
          "rb" : [0.05013, 0.000272181],
        "delb" : [270.236, 0.23847]
    },

    285 : {
        "beta" : [23.027, 0.0196],
          "rb" : [0.0494458, 0.000282081],
        "delb" : [284.853, 0.231]
    },

    300 : {
        "beta" : [23.017, 0.0196],
          "rb" : [0.0495237, 0.000278606],
        "delb" : [300.362, 0.2357]
    },

    315 : {
        "beta" : [23.04566, 0.01908],
          "rb" : [0.0498353, 0.000266385],
        "delb" : [315.6848, 0.2501]
    },

    330 : {
        "beta" : [23.02179, 0.0195],
          "rb" : [0.0498275, 0.000247208],
        "delb" : [330.177, 0.2759]
    },

    345 : {
        "beta" : [23.0169, 0.0195372],
          "rb" : [0.0498524, 0.00022517],
        "delb" : [345.835, 0.301241]
    },
}

zero_rb = {
    0 : [[23.022, 0.019],  # full DP
         [23.026, 0.019]
        ],
    1 : [[23.089, 0.043],
         [23.029, 0.043],
         [23.081, 0.043],
         [67.026, 0.043],
         [23.002, 0.043],
         [67.035, 0.043],
         [67.109, 0.040],
         [67.100, 0.043],
         [67.022, 0.043],
         [22.992, 0.043],
         [67.092, 0.043],
         [23.029, 0.043],
         [67.101, 0.043],
         [22.966, 0.043]
        ],
    2 : [[22.959, 0.107],
         [23.099, 0.109],
         [22.865, 0.107],
         [22.916, 0.108],
         [23.001, 0.108],
         [22.935, 0.107],
         [22.872, 0.107],
         [23.000, 0.108],
         [22.982, 0.108],
         [23.033, 0.108],
         [23.130, 0.108],
         [23.119, 0.109],
         [23.203, 0.109]
        ],
    3 : [[67.462, 0.048],
         [67.542, 0.048],
         [22.987, 0.048],
         [67.462, 0.048],
         [67.412, 0.048],
         [23.012, 0.048],
         [23.061, 0.048],
         [67.480, 0.048],
         [67.495, 0.048],
         [67.488, 0.048],
         [22.942, 0.048],
         [67.510, 0.048],
         [67.501, 0.048],
         [67.537, 0.048]
        ],
    4 : [[37.148, 0.078],
         [22.906, 0.064],
         [37.198, 0.078],
         [22.968, 0.064],
         [8.4972, 0.084],
         [37.058, 0.078],
         [36.903, 0.078],
         [37.089, 0.078],
         [37.051, 0.078],
         [23.024, 0.064],
         [22.927, 0.064],
         [22.877, 0.064],
         [37.169, 0.078],
         [37.063, 0.078]
        ],
    5 : [[23.027, 0.037],
         [23.003, 0.037],
         [23.054, 0.037],
         [22.945, 0.037],
         [23.024, 0.037],
         [22.969, 0.037],
         [22.965, 0.037],
         [22.974, 0.037],
         [66.608, 0.037],
         [23.021, 0.037],
         [66.616, 0.037],
         [22.979, 0.037],
         [66.614, 0.037]
        ],
    6 : [[23.035, 0.122],
         [23.353, 0.123],
         [23.019, 0.120],
         [23.034, 0.123],
         [22.913, 0.121],
         [22.888, 0.123],
         [22.936, 0.121],
         [23.237, 0.123],
         [23.022, 0.122],
         [22.894, 0.122],
         [22.686, 0.121],
         [22.950, 0.123],
         [23.056, 0.120]
        ],
    7 : [[22.927, 0.064],
         [66.026, 0.064],
         [23.049, 0.064],
         [22.972, 0.064],
         [23.022, 0.064],
         [66.010, 0.064],
         [23.020, 0.064],
         [65.939, 0.064],
         [22.920, 0.064],
         [23.129, 0.064],
         [23.080, 0.064],
         [22.975, 0.064],
         [65.948, 0.064]
        ],
    8 : [[22.948, 0.055],
         [23.051, 0.055],
         [22.959, 0.055],
         [16.095, 0.081],
         [23.024, 0.055],
         [16.166, 0.080],
         [15.835, 0.080],
         [15.882, 0.080],
         [15.931, 0.080],
         [16.032, 0.080],
         [22.958, 0.055],
         [22.990, 0.055],
         [22.939, 0.055],
         [23.012, 0.055]
        ]
}

def plot_simple_scan():
    x = sorted(full_simple.keys())
    yval = [full_simple[key][0][0] for key in x]
    yerr = [full_simple[key][0][1] for key in x]
    plt.figure(num=0)
    plt.errorbar(x, yval, 0, yerr, 'bo')
    plt.title("Full Dalitz plot")
    plt.grid()
    # plt.show()

    x = sorted(bin_scan.keys())
    print(x)
    for binn in range(1, 9):
        yval = [bin_scan[key][binn][0][0] for key in x]
        yerr = [bin_scan[key][binn][0][1] for key in x]

        plt.figure(num=binn)
        plt.errorbar(x, yval, 0, yerr, 'bo')
        plt.title("bin " + str(binn))
        plt.grid()

def plot_approx_scan():
    x = np.array(sorted(approx_scan.keys()))
    beta = [approx_scan[key]['beta'][0] for key in x]
    betae = [approx_scan[key]['beta'][1] for key in x]

    rb = [approx_scan[key]['rb'][0] for key in x]
    rbe = [approx_scan[key]['rb'][1] for key in x]

    deltab = np.array([approx_scan[key]['delb'][0] for key in x])
    deltabe = [approx_scan[key]['delb'][1] for key in x]

    plt.figure(num=1)
    plt.errorbar(x, beta, xerr=0, yerr=betae, fmt='ko')
    plt.grid()
    plt.title(r'Angle $\beta$')

    plt.figure(num=2)
    plt.errorbar(x, rb, xerr=0, yerr=rbe, fmt='ko')
    plt.grid()
    plt.title(r'$r_B$')

    plt.figure(num=3)
    plt.errorbar(x, deltab-x, xerr=0, yerr=deltabe, fmt='ko')
    plt.grid()
    plt.title(r'$\delta_B$')

def plot_null_fit():
    x, y, e = [[] for _ in range(3)]

    for key, array in zero_rb.items():
        for val, err in array:
            x, y, e = x+[key], y+[val], e+[err]

    plt.errorbar(x, y, xerr=0, yerr=e, fmt='ko')
    plt.plot([0, 8], [23, 23], 'b--')
    plt.plot([0, 8], [67, 67], 'r--')
    plt.grid()
    plt.title('Null fit')

# plot_simple_scan()
plot_approx_scan()
# plot_null_fit()
plt.show()
